{% extends 'base.html' %}
{% load static %}

{% block title %}{{ product.name }} - RedRabbit{% endblock %}
{% block description %}{{ product.meta_description|default:product.description|truncatewords:30 }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/products.css' %}">
{% endblock %}

{% block content %}
<div class="product-detail">
    <div class="container">
        
        <div class="product-detail-grid">
            <!-- –ì–∞–ª–µ—Ä–µ—è –∑–æ–±—Ä–∞–∂–µ–Ω—å -->
            <div class="product-gallery">
                <div class="product-main-image" id="mainImage">
                    {% if product.images.all %}
                        <img src="{{ product.images.first.get_image_url }}" alt="{{ product.name }}" id="currentImage">
                    {% else %}
                        <div class="product-placeholder">
                            <span>üì¶</span>
                        </div>
                    {% endif %}
                </div>
                
                {% if product.images.count > 1 %}
                <div class="product-thumbnails">
                    {% for image in product.images.all %}
                    <div class="thumbnail {% if forloop.first %}active{% endif %}" data-image="{{ image.get_image_url }}">
                        <img src="{{ image.get_image_url }}" alt="{{ image.alt_text|default:product.name }}">
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
            
            <!-- –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ —Ç–æ–≤–∞—Ä -->
            <div class="product-info">
                <h1>{{ product.name }}</h1>
                
                {% if product.sku %}
                <div class="product-sku">–ê—Ä—Ç–∏–∫—É–ª: {{ product.sku }}</div>
                {% endif %}
                
                <!-- –î—ñ—ó -->
                {% if product.is_in_stock %}
                <div class="product-detail-actions">
                    <div class="quantity-selector">
                        <button class="quantity-btn" data-action="decrease">‚àí</button>
                        <input type="number" class="quantity-input" value="1" min="1" max="{{ product.stock }}" id="productQuantity">
                        <button class="quantity-btn" data-action="increase">+</button>
                    </div>
                    <button class="btn-primary btn-add-cart" data-product-id="{{ product.id }}">
                        –î–æ–¥–∞—Ç–∏ –≤ –∫–æ—à–∏–∫
                    </button>
                    <button class="btn-wishlist" data-product-id="{{ product.id }}" title="–î–æ–¥–∞—Ç–∏ –≤ –æ–±—Ä–∞–Ω–µ">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" stroke="currentColor" stroke-width="2" fill="none"/>
                        </svg>
                    </button>
                </div>
                {% endif %}
                
                <!-- –ë–µ–π–¥–∂—ñ -->
                <div class="product-badges">
                    {% include 'includes/sale_countdown.html' with product=product %}
                    {% if product.is_new %}
                        <span class="badge badge-new">NEW</span>
                    {% endif %}
                    {% if product.is_top %}
                        <span class="badge badge-top">TOP</span>
                    {% endif %}
                </div>
                
                <!-- –¶—ñ–Ω–∞ -->
                <div class="product-detail-price">
                    {% if product.is_sale_active %}
                        <span class="price-new">{{ product.sale_price }} ‚Ç¥</span>
                        <span class="price-old">{{ product.retail_price }} ‚Ç¥</span>
                    {% else %}
                        <span class="price-current">{{ product.retail_price }} ‚Ç¥</span>
                    {% endif %}
                </div>
                
                <!-- –ì—Ä–∞–¥–∞—Ü—ñ—è —Ü—ñ–Ω -->
                {% if product.price_3_qty or product.price_5_qty %}
                <div class="price-tiers">
                    <h3>–í–∏–≥—ñ–¥–Ω—ñ —Ü—ñ–Ω–∏ –ø—Ä–∏ –ø–æ–∫—É–ø—Ü—ñ:</h3>
                    <ul>
                        {% if product.price_3_qty %}
                        <li>–í—ñ–¥ 3 —à—Ç - {{ product.price_3_qty }} ‚Ç¥</li>
                        {% endif %}
                        {% if product.price_5_qty %}
                        <li>–í—ñ–¥ 5 —à—Ç - {{ product.price_5_qty }} ‚Ç¥</li>
                        {% endif %}
                    </ul>
                </div>
                {% endif %}
                
                <!-- –ù–∞—è–≤–Ω—ñ—Å—Ç—å -->
                <div class="product-stock">
                    {% if product.is_in_stock %}
                        <span class="stock-available">‚úì –í –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ ({{ product.stock }} —à—Ç)</span>
                    {% else %}
                        <span class="stock-unavailable">‚úó –ù–µ–º–∞—î –≤ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ</span>
                    {% endif %}
                </div>
                
                <!-- –í–∫–ª–∞–¥–∫–∏ –∑ –æ–ø–∏—Å–æ–º —Ç–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º–∏ -->
                <div class="product-tabs">
                    <div class="tabs-header">
                        <button class="tab-btn active" data-tab="description">–û–ø–∏—Å</button>
                        <button class="tab-btn" data-tab="characteristics">–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</button>
                    </div>
                    
                    <div class="tabs-content">
                        <!-- –û–ø–∏—Å -->
                        <div class="tab-panel active" id="description">
                            {% if product.description %}
                                {{ product.description|safe }}
                            {% else %}
                                <p>–û–ø–∏—Å —Ç–æ–≤–∞—Ä—É –≤—ñ–¥—Å—É—Ç–Ω—ñ–π</p>
                            {% endif %}
                        </div>
                        
                        <!-- –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ -->
                        <div class="tab-panel" id="characteristics">
                            {% if product.attributes.all %}
                                {% for attr in product.attributes.all %}
                                <div class="attribute-row">
                                    <span class="attribute-name">{{ attr.name }}:</span>
                                    <span class="attribute-value">{{ attr.value }}</span>
                                </div>
                                {% endfor %}
                            {% else %}
                                <p>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ —Ç–æ–≤–∞—Ä—É –≤—ñ–¥—Å—É—Ç–Ω—ñ</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <!-- –ö–∞—Ç–µ–≥–æ—Ä—ñ—è -->
                <div class="product-category-link">
                    <a href="{{ product.primary_category.get_absolute_url }}">‚Üê –ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó "{{ product.primary_category.name }}"</a>
                </div>
            </div>
        </div>
        
        <!-- –°—Ö–æ–∂—ñ —Ç–æ–≤–∞—Ä–∏ -->
        {% with similar=product.get_similar_products %}
        {% if similar %}
        <section class="similar-products">
            <h2 class="section-title text-center">–°—Ö–æ–∂—ñ —Ç–æ–≤–∞—Ä–∏</h2>
            <div class="products-grid">
                {% for item in similar %}
                    {% include 'includes/product_card.html' with product=item %}
                {% endfor %}
            </div>
        </section>
        {% endif %}
        {% endwith %}
        
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // –ü–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è –≤–∫–ª–∞–¥–æ–∫
    const tabBtns = document.querySelectorAll('.tab-btn');
    const tabPanels = document.querySelectorAll('.tab-panel');
    
    tabBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const tabId = this.dataset.tab;
            
            tabBtns.forEach(b => b.classList.remove('active'));
            tabPanels.forEach(p => p.classList.remove('active'));
            
            this.classList.add('active');
            document.getElementById(tabId).classList.add('active');
        });
    });
    
    // –ü–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è –∑–æ–±—Ä–∞–∂–µ–Ω—å
    const thumbnails = document.querySelectorAll('.thumbnail');
    const currentImage = document.getElementById('currentImage');
    
    thumbnails.forEach(thumbnail => {
        thumbnail.addEventListener('click', function() {
            const imageUrl = this.dataset.image;
            if (currentImage) {
                currentImage.src = imageUrl;
            }
            
            thumbnails.forEach(t => t.classList.remove('active'));
            this.classList.add('active');
        });
    });
    
    // –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∫—ñ–ª—å–∫—ñ—Å—Ç—é
    const quantityInput = document.getElementById('productQuantity');
    const quantityBtns = document.querySelectorAll('.quantity-btn');
    
    quantityBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const action = this.dataset.action;
            let value = parseInt(quantityInput.value);
            const max = parseInt(quantityInput.max);
            
            if (action === 'increase' && value < max) {
                quantityInput.value = value + 1;
            } else if (action === 'decrease' && value > 1) {
                quantityInput.value = value - 1;
            }
        });
    });
    
});
</script>
{% endblock %}

