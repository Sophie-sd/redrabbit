{% extends 'base.html' %}
{% load static %}

{% block title %}{{ category.name }} - Beauty Shop{% endblock %}
{% block description %}{{ category.meta_description|default:category.description|truncatewords:20 }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/catalog.css' %}">
{% endblock %}

{% block content %}
<div class="catalog-container">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∫–∞—Ç–∞–ª–æ–≥—É –∑ –≤—ñ–¥—Å—Ç—É–ø–æ–º -->
    <header class="catalog-header">
        <h1 class="catalog-title">{{ category.name }}</h1>
        {% if category.description %}
            <p class="catalog-subtitle">{{ category.description }}</p>
        {% endif %}
    </header>
    
    <!-- –û—Å–Ω–æ–≤–Ω–∏–π layout –∫–∞—Ç–∞–ª–æ–≥—É -->
    <div class="catalog-layout">
        <!-- –ë–æ–∫–æ–≤–∞ –ø–∞–Ω–µ–ª—å —Ñ—ñ–ª—å—Ç—Ä—ñ–≤ (desktop) -->
        <aside class="catalog-sidebar" id="catalogSidebar">
            <div class="filters-panel">
                        <div class="filters-header">
                            <h3 class="filters-title">–§—ñ–ª—å—Ç—Ä–∏</h3>
                            <button type="button" class="filters-close" id="mobileFiltersClose" aria-label="–ó–∞–∫—Ä–∏—Ç–∏ —Ñ—ñ–ª—å—Ç—Ä–∏">
                                ‚úï
                            </button>
                        </div>
                        
                        <div class="filters-content">
                            <!-- –§—ñ–ª—å—Ç—Ä –∑–∞ —Ü—ñ–Ω–æ—é -->
                            <div class="filter-section">
                                <h4 class="filter-title">–¶—ñ–Ω–∞ (‚Ç¥)</h4>
                                <div class="price-range-filter">
                                    <input 
                                        type="number" 
                                        class="price-input" 
                                        id="priceMin" 
                                        placeholder="–í—ñ–¥" 
                                        min="0"
                                    >
                                    <span class="price-separator">‚Äî</span>
                                    <input 
                                        type="number" 
                                        class="price-input" 
                                        id="priceMax" 
                                        placeholder="–î–æ" 
                                        min="0"
                                    >
                                </div>
                            </div>
                            
                            <!-- –¢–ò–ú–ß–ê–°–û–í–û –ó–ê–ö–û–ú–ï–ù–¢–û–í–ê–ù–û - –¥–æ–¥–∞–º–æ –ø—ñ—Å–ª—è –º—ñ–≥—Ä–∞—Ü—ñ—ó
                            <!-- –§—ñ–ª—å—Ç—Ä –∑–∞ –±—Ä–µ–Ω–¥–æ–º -->
                            <!--<div class="filter-section">
                                <h4 class="filter-title">–ë—Ä–µ–Ω–¥</h4>
                                <div class="filter-options" id="brandFilters">
                                    {% for brand in brands %}
                                        <label class="filter-checkbox">
                                            <input type="checkbox" value="{{ brand.slug }}" name="brand">
                                            <span class="filter-label">{{ brand.name }}</span>
                                            <span class="filter-count">({{ brand.products_count }})</span>
                                        </label>
                                    {% endfor %}
                                </div>
                            </div>
                            
                            <!-- –§—ñ–ª—å—Ç—Ä –∑–∞ –≥—Ä—É–ø–æ—é —Ç–æ–≤–∞—Ä—ñ–≤ -->
                            <!--<div class="filter-section">
                                <h4 class="filter-title">–ì—Ä—É–ø–∞ —Ç–æ–≤–∞—Ä—ñ–≤</h4>
                                <div class="filter-options" id="groupFilters">
                                    {% for group in product_groups %}
                                        <label class="filter-checkbox">
                                            <input type="checkbox" value="{{ group.slug }}" name="group">
                                            <span class="filter-label">{{ group.name }}</span>
                                            <span class="filter-count">({{ group.products_count }})</span>
                                        </label>
                                    {% endfor %}
                                </div>
                            </div>
                            
                            <!-- –§—ñ–ª—å—Ç—Ä –∑–∞ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è–º -->
                            <!--<div class="filter-section">
                                <h4 class="filter-title">–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è</h4>
                                <div class="filter-options" id="purposeFilters">
                                    {% for purpose in purposes %}
                                        <label class="filter-checkbox">
                                            <input type="checkbox" value="{{ purpose.slug }}" name="purpose">
                                            <span class="filter-label">{{ purpose.name }}</span>
                                            <span class="filter-count">({{ purpose.products_count }})</span>
                                        </label>
                                    {% endfor %}
                                </div>
                            </div>-->
                            
                            <!-- –§—ñ–ª—å—Ç—Ä –∑–∞ –Ω–∞—è–≤–Ω—ñ—Å—Ç—é -->
                            <div class="filter-section">
                                <h4 class="filter-title">–ù–∞—è–≤–Ω—ñ—Å—Ç—å</h4>
                                <div class="filter-options">
                                    <label class="filter-checkbox">
                                        <input type="checkbox" value="in_stock" name="availability">
                                        <span class="filter-label">–í –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ</span>
                                    </label>
                                    <label class="filter-checkbox">
                                        <input type="checkbox" value="out_of_stock" name="availability">
                                        <span class="filter-label">–ü—ñ–¥ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</span>
                                    </label>
                                </div>
                            </div>
                            
                            <!-- –§—ñ–ª—å—Ç—Ä –∑–∞ —Ç–∏–ø–æ–º -->
                            <div class="filter-section">
                                <h4 class="filter-title">–¢–∏–ø —Ç–æ–≤–∞—Ä—É</h4>
                                <div class="filter-options">
                                    <label class="filter-checkbox">
                                        <input type="checkbox" value="new" name="type">
                                        <span class="filter-label">–ù–æ–≤–∏–Ω–∫–∏</span>
                                    </label>
                                    <label class="filter-checkbox">
                                        <input type="checkbox" value="sale" name="type">
                                        <span class="filter-label">–ê–∫—Ü—ñ–π–Ω—ñ</span>
                                    </label>
                                    <label class="filter-checkbox">
                                        <input type="checkbox" value="top" name="type">
                                        <span class="filter-label">–•—ñ—Ç–∏ –ø—Ä–æ–¥–∞–∂—É</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <!-- –ö–Ω–æ–ø–∫–∞ –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è —Ñ—ñ–ª—å—Ç—Ä—ñ–≤ -->
                        <div class="filters-actions">
                            <button type="button" class="filters-clear-btn" id="clearAllFilters">
                                –û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—ñ
                            </button>
                            <button type="button" class="filters-apply-btn" id="applyFiltersBtn">
                                –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ —Ñ—ñ–ª—å—Ç—Ä–∏
                            </button>
                        </div>
            </div>
        </aside>
        
        <!-- –û—Å–Ω–æ–≤–Ω–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <main class="catalog-main">
            <!-- –ú–æ–±—ñ–ª—å–Ω–∞ –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è -->
            <div class="mobile-controls">
                <button type="button" class="mobile-filters-btn" id="mobileFiltersBtn">
                    <svg class="btn-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M3 4H21V6H3V4ZM6 10H18V12H6V10ZM9 16H15V18H9V16Z" fill="currentColor"/>
                    </svg>
                    <span>–§—ñ–ª—å—Ç—Ä–∏</span>
                    <span class="filters-count hidden" id="mobileFiltersCount">(0)</span>
                </button>
                
                <div class="sort-control">
                    <button type="button" class="sort-select-btn" id="sortSelectBtn">
                        <span class="sort-select-text">–°–æ—Ä—Ç—É–≤–∞—Ç–∏ –∑–∞</span>
                        <svg class="sort-select-arrow" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M7 10L12 15L17 10H7Z" fill="currentColor"/>
                        </svg>
                    </button>
                    <div class="sort-dropdown hidden" id="sortDropdown">
                        <div class="sort-option" data-value="default">–ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º</div>
                        <div class="sort-option" data-value="price_asc">–ó–∞ —Ü—ñ–Ω–æ—é: –¥–µ—à–µ–≤—à—ñ —Å–ø–æ—á–∞—Ç–∫—É</div>
                        <div class="sort-option" data-value="price_desc">–ó–∞ —Ü—ñ–Ω–æ—é: –¥–æ—Ä–æ–∂—á—ñ —Å–ø–æ—á–∞—Ç–∫—É</div>
                        <div class="sort-option" data-value="name">–ó–∞ –Ω–∞–∑–≤–æ—é</div>
                        <div class="sort-option" data-value="popular">–ó–∞ –ø–æ–ø—É–ª—è—Ä–Ω—ñ—Å—Ç—é</div>
                        <div class="sort-option" data-value="new">–ó–∞ –Ω–æ–≤–∏–∑–Ω–æ—é</div>
                    </div>
                </div>
            </div>
            
            <!-- –ê–∫—Ç–∏–≤–Ω—ñ —Ñ—ñ–ª—å—Ç—Ä–∏ -->
            <div class="active-filters hidden" id="activeFilters">
                <!-- –î–∏–Ω–∞–º—ñ—á–Ω–æ –¥–æ–¥–∞—é—Ç—å—Å—è JS -->
            </div>
        
        <!-- –°—ñ—Ç–∫–∞ —Ç–æ–≤–∞—Ä—ñ–≤ –∞–±–æ –ø–æ—Ä–æ–∂–Ω—ñ–π —Å—Ç–∞–Ω -->
        {% if products %}
            <div class="products-grid" id="productsGrid" role="main" aria-live="polite">
                {% for product in products %}
                    <article class="product-card" 
                         data-price="{{ product.retail_price }}" 
                         data-sale-price="{{ product.sale_price|default:product.retail_price }}"
                         data-in-stock="{{ product.is_in_stock }}"
                         data-is-sale="{{ product.is_sale }}"
                         data-is-new="{{ product.is_new }}"
                         data-is-top="{{ product.is_top }}"
                         data-name="{{ product.name }}">
                         
                        <!-- –ú–µ–¥—ñ–∞–±–ª–æ–∫ -->
                        <div class="product-card__media">
                            {% if product.images.first %}
                                <img 
                                    src="{{ product.images.first.image.url }}" 
                                    alt="{{ product.name }}" 
                                    class="product-card__image"
                                    loading="lazy"
                                    width="300"
                                    height="300"
                                >
                            {% else %}
                                <div class="product-card__placeholder" aria-label="–ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ç–æ–≤–∞—Ä—É –≤—ñ–¥—Å—É—Ç–Ω—î">
                                    üì¶
                                </div>
                            {% endif %}
                            
                            <!-- –ö–Ω–æ–ø–∫–∞ –æ–±—Ä–∞–Ω–æ–≥–æ -->
                            <button 
                                type="button"
                                class="product-card__wishlist" 
                                data-product-id="{{ product.id }}" 
                                aria-label="–î–æ–¥–∞—Ç–∏ –≤ –æ–±—Ä–∞–Ω–µ"
                                title="–î–æ–¥–∞—Ç–∏ –≤ –æ–±—Ä–∞–Ω–µ"
                            >
                                <span class="product-card__wishlist-icon" aria-hidden="true">‚ô°</span>
                            </button>
                            
                            <!-- –ë–µ–π–¥–∂—ñ -->
                            {% if product.is_sale or product.is_new or product.is_top %}
                                <div class="product-card__badges">
                                    {% if product.is_sale %}
                                        <span class="product-badge product-badge--sale" aria-label="–ó–Ω–∏–∂–∫–∞">
                                            -{{ product.get_discount_percentage }}%
                                        </span>
                                    {% endif %}
                                    {% if product.is_new %}
                                        <span class="product-badge product-badge--new" aria-label="–ù–æ–≤–∏–Ω–∫–∞">
                                            NEW
                                        </span>
                                    {% endif %}
                                    {% if product.is_top %}
                                        <span class="product-badge product-badge--hit" aria-label="–•—ñ—Ç –ø—Ä–æ–¥–∞–∂—É">
                                            –•–Ü–¢
                                        </span>
                                    {% endif %}
                                </div>
                            {% endif %}
                        </div>
                        
                        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –∫–∞—Ä—Ç–∫–∏ -->
                        <div class="product-card__content">
                            <h3 class="product-card__name" title="{{ product.name }}">
                                <a href="{{ product.get_absolute_url }}" class="product-card__link">
                                    {{ product.name }}
                                </a>
                            </h3>
                            
                            <div class="product-card__price">
                                {% if product.is_sale and product.sale_price %}
                                    <span class="product-card__price-current" aria-label="–ê–∫—Ü—ñ–π–Ω–∞ —Ü—ñ–Ω–∞">
                                        {{ product.sale_price }} ‚Ç¥
                                    </span>
                                    <span class="product-card__price-old" aria-label="–°—Ç–∞—Ä–∞ —Ü—ñ–Ω–∞">
                                        {{ product.retail_price }} ‚Ç¥
                                    </span>
                                    <span class="product-card__price-save" aria-label="–ï–∫–æ–Ω–æ–º—ñ—è">
                                        -{{ product.get_discount_amount }} ‚Ç¥
                                    </span>
                                {% else %}
                                    <span class="product-card__price-current" aria-label="–¶—ñ–Ω–∞">
                                        {{ product.retail_price }} ‚Ç¥
                                    </span>
                                {% endif %}
                            </div>
                        </div>
                        
                        <!-- –î—ñ—ó –∫–∞—Ä—Ç–∫–∏ -->
                        <div class="product-card__actions">
                            {% if product.is_in_stock %}
                                <button 
                                    type="button"
                                    class="product-card__add-cart" 
                                    data-product-id="{{ product.id }}"
                                    aria-label="–î–æ–¥–∞—Ç–∏ {{ product.name }} –¥–æ –∫–æ—à–∏–∫–∞"
                                >
                                    –î–æ –∫–æ—à–∏–∫–∞
                                </button>
                            {% else %}
                                <button 
                                    type="button"
                                    class="product-card__add-cart product-card__add-cart--disabled" 
                                    disabled
                                    aria-label="–¢–æ–≤–∞—Ä —Ç–∏–º—á–∞—Å–æ–≤–æ –≤—ñ–¥—Å—É—Ç–Ω—ñ–π"
                                >
                                    –ù–µ–º–∞—î –≤ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ
                                </button>
                            {% endif %}
                        </div>
                        
                        <!-- –û–≤–µ—Ä–ª–µ–π –¥–ª—è —Ç–æ–≤–∞—Ä—ñ–≤ –Ω–µ –≤ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ -->
                        {% if not product.is_in_stock %}
                            <div class="product-card__out-of-stock-label" aria-hidden="true">
                                –ù–µ–º–∞—î –≤ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ
                            </div>
                        {% endif %}
                    </article>
                {% endfor %}
            </div>
        {% else %}
            <!-- –ü–æ—Ä–æ–∂–Ω—ñ–π —Å—Ç–∞–Ω -->
            <div class="empty-state" role="status" aria-live="polite">
                <div class="empty-state__icon" aria-hidden="true">üõçÔ∏è</div>
                <h2 class="empty-state__title">–í —Ü—ñ–π –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó –ø–æ–∫–∏ –Ω–µ–º–∞—î —Ç–æ–≤–∞—Ä—ñ–≤</h2>
                <p class="empty-state__description">
                    –°–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ —ñ–Ω—à—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó –∞–±–æ –∑–º—ñ–Ω–∏—Ç–∏ —Ñ—ñ–ª—å—Ç—Ä–∏ –ø–æ—à—É–∫—É
                </p>
                <div class="empty-state__actions">
                    <a href="{% url 'core:catalog' %}" class="empty-state__button empty-state__button--primary">
                        ‚Üê –ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ –∫–∞—Ç–∞–ª–æ–≥—É
                    </a>
                    <button type="button" class="empty-state__button empty-state__button--secondary" id="clearAllFilters">
                        –°–∫–∏–Ω—É—Ç–∏ —Ñ—ñ–ª—å—Ç—Ä–∏
                    </button>
                </div>
            </div>
        {% endif %}
        
        <!-- Skeleton loader –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è -->
        <div class="products-grid hidden" id="skeletonGrid" aria-hidden="true">
            {% for i in "123456789012" %}
                <div class="product-card-skeleton">
                    <div class="product-card-skeleton__media skeleton"></div>
                    <div class="product-card-skeleton__content">
                        <div class="product-card-skeleton__name skeleton"></div>
                        <div class="product-card-skeleton__price skeleton"></div>
                        <div class="product-card-skeleton__button skeleton"></div>
                    </div>
                </div>
            {% endfor %}
        </div>
        
        <!-- –ü–∞–≥—ñ–Ω–∞—Ü—ñ—è -->
        {% if is_paginated %}
            <nav class="pagination" role="navigation" aria-label="–ù–∞–≤—ñ–≥–∞—Ü—ñ—è –ø–æ —Å—Ç–æ—Ä—ñ–Ω–∫–∞—Ö">
                {% if page_obj.has_previous %}
                    <a href="?page=1" class="pagination__link" aria-label="–ü–µ—Ä—à–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞">
                        ‚ü®‚ü®
                    </a>
                    <a href="?page={{ page_obj.previous_page_number }}" class="pagination__link" aria-label="–ü–æ–ø–µ—Ä–µ–¥–Ω—è —Å—Ç–æ—Ä—ñ–Ω–∫–∞">
                        ‚ü® –ü–æ–ø–µ—Ä–µ–¥–Ω—è
                    </a>
                {% else %}
                    <span class="pagination__link pagination__link--disabled" aria-disabled="true">
                        ‚ü®‚ü®
                    </span>
                    <span class="pagination__link pagination__link--disabled" aria-disabled="true">
                        ‚ü® –ü–æ–ø–µ—Ä–µ–¥–Ω—è
                    </span>
                {% endif %}
                
                <span class="pagination__info" aria-live="polite">
                    –°—Ç–æ—Ä—ñ–Ω–∫–∞ {{ page_obj.number }} –∑ {{ page_obj.paginator.num_pages }}
                </span>
                
                {% if page_obj.has_next %}
                    <a href="?page={{ page_obj.next_page_number }}" class="pagination__link" aria-label="–ù–∞—Å—Ç—É–ø–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞">
                        –ù–∞—Å—Ç—É–ø–Ω–∞ ‚ü©
                    </a>
                    <a href="?page={{ page_obj.paginator.num_pages }}" class="pagination__link" aria-label="–û—Å—Ç–∞–Ω–Ω—è —Å—Ç–æ—Ä—ñ–Ω–∫–∞">
                        ‚ü©‚ü©
                    </a>
                {% else %}
                    <span class="pagination__link pagination__link--disabled" aria-disabled="true">
                        –ù–∞—Å—Ç—É–ø–Ω–∞ ‚ü©
                    </span>
                    <span class="pagination__link pagination__link--disabled" aria-disabled="true">
                        ‚ü©‚ü©
                    </span>
                {% endif %}
            </nav>
            
            <!-- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞ –ø–∞–≥—ñ–Ω–∞—Ü—ñ—è –¥–ª—è –º–æ–±—ñ–ª—å–Ω–∏—Ö -->
            <div class="pagination-mobile hidden">
                {% if page_obj.has_next %}
                    <button type="button" class="pagination__load-more" id="loadMoreBtn" data-next-page="{{ page_obj.next_page_number }}">
                        –ü–æ–∫–∞–∑–∞—Ç–∏ —â–µ —Ç–æ–≤–∞—Ä–∏
                    </button>
                {% endif %}
            </div>
        {% endif %}
    </main>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ —Ñ—ñ–ª—å—Ç—Ä—ñ–≤ –¥–ª—è –º–æ–±—ñ–ª—å–Ω–∏—Ö -->
<div class="modal-filters hidden" id="mobileFiltersModal" role="dialog" aria-modal="true" aria-labelledby="mobileFiltersTitle">
    <div class="modal-filters__backdrop"></div>
    <div class="modal-filters__content">
        <header class="modal-filters__header">
            <h2 class="modal-filters__title" id="mobileFiltersTitle">–§—ñ–ª—å—Ç—Ä–∏</h2>
            <button type="button" class="modal-filters__close" aria-label="–ó–∞–∫—Ä–∏—Ç–∏ —Ñ—ñ–ª—å—Ç—Ä–∏">
                ‚úï
            </button>
        </header>
        
        <div class="modal-filters__body">
            <!-- –ö–æ–Ω—Ç–µ–Ω—Ç —Ñ—ñ–ª—å—Ç—Ä—ñ–≤ –±—É–¥–µ —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–∏–π —Å—é–¥–∏ JS -->
        </div>
        
        <footer class="modal-filters__footer">
            <button type="button" class="modal-filters__clear">–û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å–µ</button>
            <button type="button" class="modal-filters__apply">–ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏</button>
        </footer>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/catalog.js' %}"></script>
{% endblock %}

