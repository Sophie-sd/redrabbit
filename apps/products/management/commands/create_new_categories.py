"""
–°—Ç–≤–æ—Ä—é—î –Ω–æ–≤—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–∞—Ç–µ–≥–æ—Ä—ñ–π –∑–≥—ñ–¥–Ω–æ –Ω–æ–≤–æ—ó —Å—Ö–µ–º–∏
"""
from django.core.management.base import BaseCommand
from django.utils.text import slugify
from apps.products.models import Category


class Command(BaseCommand):
    help = '–°—Ç–≤–æ—Ä—é—î –Ω–æ–≤—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–∞—Ç–µ–≥–æ—Ä—ñ–π'

    def handle(self, *args, **options):
        self.stdout.write(self.style.SUCCESS('–°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ—ó —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ–π...'))
        
        # –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ–π –∑ —ñ–∫–æ–Ω–∫–∞–º–∏ —Ç–∞ —Ç–∏–ø–∞–º–∏
        categories_structure = [
            {
                'name': '–°–µ–∫—Å-—ñ–≥—Ä–∞—à–∫–∏',
                'icon': 'üéÄ',
                'type': 'general',
                'children': [
                    '–í—ñ–±—Ä–∞—Ç–æ—Ä–∏',
                    '–§–∞–ª–æ—ñ–º—ñ—Ç–∞—Ç–æ—Ä–∏',
                    '–ú–∞—Å—Ç—É—Ä–±–∞—Ç–æ—Ä–∏ —ñ –≤–∞–≥—ñ–Ω–∏',
                    '–°–º–∞—Ä—Ç-—ñ–≥—Ä–∞—à–∫–∏',
                    '–í–∞–∫—É—É–º–Ω—ñ —Å—Ç–∏–º—É–ª—è—Ç–æ—Ä–∏',
                    '–ê–Ω–∞–ª—å–Ω—ñ —ñ–≥—Ä–∞—à–∫–∏',
                    '–í–∞–≥—ñ–Ω–∞–ª—å–Ω—ñ –∫—É–ª—å–∫–∏',
                    '–°—Ç—Ä–∞–ø–æ–Ω–∏',
                    '–ù–∞—Å–∞–¥–∫–∏ —Ç–∞ –µ—Ä–µ–∫—Ü—ñ–π–Ω—ñ –∫—ñ–ª—å—Ü—è',
                    '–ü–æ–º–ø–∞ –¥–ª—è —á–ª–µ–Ω–∞',
                    '–°–µ–∫—Å-–ª—è–ª—å–∫–∏',
                    '–°–µ–∫—Å –º–∞—à–∏–Ω–∏',
                    '–°–µ–∫—Å –º–µ–±–ª—ñ',
                ]
            },
            {
                'name': '–ë—ñ–ª–∏–∑–Ω–∞, –∫–æ—Å—Ç—é–º–∏',
                'icon': 'üëô',
                'type': 'general',
                'children': [
                    '–ö–æ–º–ø–ª–µ–∫—Ç–∏',
                    '–ë–æ–¥—ñ',
                    '–ö–æ—Ä—Å–µ—Ç–∏',
                    '–ü–µ–Ω—å—é–∞—Ä–∏ —ñ —Å–æ—Ä–æ—á–∫–∏',
                    '–ï—Ä–æ—Ç–∏—á–Ω—ñ –±–æ–¥—ñ—Å—Ç–æ–∫—ñ–Ω–≥–∏ —ñ –∫–æ—Å—Ç—é–º–∏-—Å—ñ—Ç–∫–∞',
                    '–õ–∞–∫–æ–≤–∞–Ω–∞ –±—ñ–ª–∏–∑–Ω–∞',
                    '–ì–∞—Ä—Ç–µ—Ä–∏, —á–æ–∫–µ—Ä–∏, –ø–æ—Ä—Ç—É–ø–µ—ó',
                    '–†–æ–ª—å–æ–≤—ñ –∫–æ—Å—Ç—é–º–∏',
                ]
            },
            {
                'name': '–ë–î–°–ú, –§–µ—Ç–∏—à',
                'icon': 'üîó',
                'type': 'general',
                'children': [
                    '–ù–∞–±–æ—Ä–∏ —ñ–≥—Ä–∞—à–æ–∫',
                    '–ú–∞—Å–∫–∏, –ø–æ–≤\'—è–∑–∫–∏',
                    '–ö–ª—è–ø–∏',
                    '–ù–∞—à–∏–π–Ω–∏–∫–∏, –ø–æ–≤—ñ–¥—Ü—ñ',
                    '–ë–∞—Ç–æ–≥–∏, —Å—Ç–µ–∫–∏, —Ñ–ª–æ–≥–µ—Ä–∏, –ª—è—Å–∫–∞–ª–∫–∏',
                    '–ó–∞—Ç–∏—Å–∫–∞—á—ñ –¥–ª—è —Å–æ—Å–∫—ñ–≤ —Ç–∞ –≥—Ä—É–¥–µ–π',
                    '–°–≤—ñ—á–∫–∏ –¥–ª—è BDSM',
                ]
            },
            {
                'name': '–ü—Ä–µ–ª—é–¥—ñ—è',
                'icon': 'üìÖ',
                'type': 'general',
                'children': [
                    '–°—Ç–∏–º—É–ª—è—Ç–æ—Ä–∏ –¥–ª—è –∫–ª—ñ—Ç–æ—Ä–∞',
                    '–†—ñ–¥–∫–∏–π –≤—ñ–±—Ä–∞—Ç–æ—Ä',
                    '–ü—Ä–æ–ª–æ–Ω–≥–∞—Ç–æ—Ä–∏ –¥–ª—è —á–æ–ª–æ–≤—ñ–∫—ñ–≤',
                    '–ö–æ—Å–º–µ—Ç–∏–∫–∞ –∑ —Ñ–µ—Ä–æ–º–æ–Ω–∞–º–∏',
                    '–ó–∞—Å–æ–±–∏ –¥–ª—è –æ—Ä–∞–ª—å–Ω–∏—Ö –ª–∞—Å–∫',
                    '–°—Ç–∏–º—É–ª—è—Ç–æ—Ä–∏ –¥–ª—è —Ç–æ—á–∫–∏ G',
                    '–°—Ç–∏–º—É–ª—è—Ç–æ—Ä–∏ –¥–ª—è –ø–µ–Ω—ñ—Å–∞',
                    '–ú–∞—Å–∞–∂–Ω—ñ —Å–≤—ñ—á–∫–∏',
                    '–ö–ª–∞—Å–∏—á–Ω—ñ –º–∞—Å–ª–∞ –Ω–∞ –º–∞—Å–ª—è–Ω—ñ–π –æ—Å–Ω–æ–≤—ñ',
                    '–ú–∞—Å–∞–∂–Ω—ñ –ø—ñ–Ω–∫–∏',
                    '–°—Ç–∏–º—É–ª—è—Ç–æ—Ä–∏ –¥–ª—è —Å–æ—Å–∫—ñ–≤',
                    '–ó–≤—É–∂—É—é—á—ñ –∑–∞—Å–æ–±–∏',
                    '–î–ª—è —ñ–Ω—Ç–∏–º–Ω–æ—ó –≥—ñ–≥—ñ—î–Ω–∏',
                ]
            },
            {
                'name': '–õ—É–±—Ä–∏–∫–∞–Ω—Ç–∏',
                'icon': 'üß¥',
                'type': 'general',
                'children': [
                    '–í–∞–≥—ñ–Ω–∞–ª—å–Ω—ñ',
                    '–ê–Ω–∞–ª—å–Ω—ñ',
                    '–û—Ä–∞–ª—å–Ω—ñ (—ó—Å—Ç—ñ–≤–Ω—ñ)',
                    '–ü—Ä–æ–±–Ω–∏–∫–∏',
                    '–î–ª—è –º–∞—Å—Ç—É—Ä–±–∞—Ç–æ—Ä—ñ–≤',
                ]
            },
            {
                'name': '–°–µ–∫—Å—É–∞–ª—å–Ω–µ –∑–¥–æ—Ä–æ–≤\'—è',
                'icon': 'ü©∫',
                'type': 'general',
                'children': [
                    '–ú–∞—Å–∞–∂–µ—Ä–∏ –ø—Ä–æ—Å—Ç–∞—Ç–∏',
                    '–¢—Ä–µ–Ω–∞–∂–µ—Ä–∏ –ö–µ–≥–µ–ª—è',
                    '–ï–∫—Å—Ç–µ–Ω–¥–µ—Ä–∏ (–∑–±—ñ–ª—å—à–µ–Ω–Ω—è —á–ª–µ–Ω–∞)',
                    '–í–∞–∫—É—É–º–Ω—ñ –ø–æ–º–ø–∏, –≥—ñ–¥—Ä–æ–ø–æ–º–ø–∏',
                    '–í–∞–≥—ñ–Ω–∞–ª—å–Ω—ñ –∫—É–ª—å–∫–∏',
                ]
            },
            {
                'name': '–ñ—ñ–Ω–∫–∞–º',
                'icon': '‚ôÄ',
                'type': 'women',
                'children': [
                    '–í—ñ–±—Ä–∞—Ç–æ—Ä–∏',
                    '–í—ñ–±—Ä–æ–∫—É–ª—ñ',
                    '–ö—Ä–æ–ª–∏–∫–∏',
                    '–î–ª—è –ø–∞—Ä (We-Vibe)',
                    '–í–∞–∫—É—É–º–Ω—ñ',
                    '–ó–æ–Ω–∞ G',
                    '–í–∞–≥—ñ–Ω–∞–ª—å–Ω–æ-–∫–ª—ñ—Ç–æ—Ä–∞–ª—å–Ω—ñ',
                    '–§–∞–ª–æ—ñ–º—ñ—Ç–∞—Ç–æ—Ä–∏ –∑ –≤—ñ–±—Ä–∞—Ü—ñ—î—é',
                    '–†–µ–∞–ª—ñ—Å—Ç–∏—á–Ω—ñ',
                    '–í—ñ–±—Ä–æ—è–π—Ü—è',
                    'Hi-tech —ñ–≥—Ä–∞—à–∫–∏',
                    '–ü—É–ª—å—Å–∞—Ç–æ—Ä–∏',
                ]
            },
            {
                'name': '–ß–æ–ª–æ–≤—ñ–∫–∞–º',
                'icon': '‚ôÇ',
                'type': 'men',
                'children': [
                    '–í–∞–≥—ñ–Ω–∏ (—Ä–µ–∞–ª—ñ—Å—Ç–∏—á–Ω—ñ –º–∞—Å—Ç—É—Ä–±–∞—Ç–æ—Ä–∏)',
                    '–ü–æ–∫–µ—Ç-–º–∞—Å—Ç—É—Ä–±–∞—Ç–æ—Ä–∏',
                    '–ó –≤—ñ–±—Ä–∞—Ü—ñ—î—é —ñ Hi-Tech',
                    '–ú–∞—Å–∞–∂–µ—Ä–∏ –ø—Ä–æ—Å—Ç–∞—Ç–∏ –∑ –≤—ñ–±—Ä–∞—Ü—ñ—î—é',
                    '–í–∞–∫—É—É–º–Ω—ñ –ø–æ–º–ø–∏',
                    '–ì—ñ–¥—Ä–æ–ø–æ–º–ø–∏',
                    '–ï–∫—Å—Ç–µ–Ω–¥–µ—Ä–∏',
                ]
            },
            {
                'name': '–î–ª—è –¥–≤–æ—Ö',
                'icon': 'üíë',
                'type': 'couple',
                'children': [
                    '–ù–∞ –ø–æ–¥–∞—Ä—É–Ω–æ–∫',
                    '–°–µ–∫—Å —ñ–≥—Ä–∏ –¥–ª—è –ø–∞—Ä–∏',
                    '–î–ª—è –∑–∞–∫–æ—Ö–∞–Ω–∏—Ö',
                    '–í—ñ–±—Ä–∞—Ç–æ—Ä–∏',
                    '–§–∞–ª–æ—ñ–º—ñ—Ç–∞—Ç–æ—Ä–∏',
                    '–°—Ç—Ä–∞–ø–æ–Ω–∏',
                    '–õ—É–±—Ä–∏–∫–∞–Ω—Ç–∏',
                    '–ü—Ä–µ–ª—é–¥—ñ—è',
                    '–°–º–∞—Ä—Ç-—ñ–≥—Ä–∞—à–∫–∏',
                ]
            },
        ]
        
        created_count = 0
        
        for cat_data in categories_structure:
            # –°—Ç–≤–æ—Ä—é—î–º–æ –≥–æ–ª–æ–≤–Ω—É –∫–∞—Ç–µ–≥–æ—Ä—ñ—é
            parent_slug = slugify(cat_data['name'])
            parent, created = Category.objects.get_or_create(
                slug=parent_slug,
                defaults={
                    'name': cat_data['name'],
                    'icon': cat_data['icon'],
                    'category_type': cat_data['type'],
                    'is_active': True,
                    'sort_order': created_count,
                }
            )
            
            if created:
                self.stdout.write(f'  ‚úì –°—Ç–≤–æ—Ä–µ–Ω–æ: {parent.name} ({parent.icon})')
                created_count += 1
            else:
                # –û–Ω–æ–≤–ª—é—î–º–æ —ñ–∫–æ–Ω–∫—É —Ç–∞ —Ç–∏–ø
                parent.icon = cat_data['icon']
                parent.category_type = cat_data['type']
                parent.save()
                self.stdout.write(f'  ‚Üª –û–Ω–æ–≤–ª–µ–Ω–æ: {parent.name}')
            
            # –°—Ç–≤–æ—Ä—é—î–º–æ –ø—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—ó
            for idx, child_name in enumerate(cat_data.get('children', [])):
                child_slug = slugify(f"{parent_slug}-{child_name}")
                child, child_created = Category.objects.get_or_create(
                    slug=child_slug,
                    defaults={
                        'name': child_name,
                        'parent': parent,
                        'is_active': True,
                        'sort_order': idx,
                        'category_type': cat_data['type'],
                    }
                )
                
                if child_created:
                    self.stdout.write(f'    ‚úì –ü—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—è: {child.name}')
                    created_count += 1
        
        self.stdout.write(self.style.SUCCESS(f'\n‚úì –ó–∞–≤–µ—Ä—à–µ–Ω–æ! –°—Ç–≤–æ—Ä–µ–Ω–æ/–æ–Ω–æ–≤–ª–µ–Ω–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ–π: {created_count}'))

